(function(f){var e=function(a,c,b,d){this.target=a;this.url=c;this.html=[];this.options=jQuery.extend({ssl:!1,limit:null,key:null,layoutTemplate:"<ul>{entries}</ul>",entryTemplate:'<li><a href="{url}">[{author}@{date}] {title}</a><br/>{shortBodyPlain}</li>',tokens:{},outputMode:"json"},b||{});this.callback=d};e.prototype.load=function(a){var c="http"+(this.options.ssl?"s":"")+"://ajax.googleapis.com/ajax/services/feed/load?v=1.0&output="+this.options.outputMode+"&callback=?&q="+encodeURIComponent(this.url);
null!=this.options.limit&&(c+="&num="+this.options.limit);null!=this.options.key&&(c+="&key="+this.options.key);f.getJSON(c,a)};e.prototype.render=function(){var a=this,c=this.options.entryTemplate;this.load(function(b){a.entries=b.responseData.feed.entries;jQuery(a.entries).each(function(){if(a.isRelevant(this)){var b=a.evaluateStringForEntry(c,this);a.html.push(b)}});b=a.html.join("\n");b=a.options.entryTemplate?a.options.layoutTemplate.replace("{entries}",b):0==jQuery(b).length?jQuery("<div>"+
b+"</div>"):jQuery(b);a.target.append(b);f.isFunction(a.callback)&&a.callback.call(a)})};e.prototype.evaluateStringForEntry=function(a,c){var b=a,d=this;jQuery(a.match(/(\{.*?\})/g)).each(function(){var a=this.toString();b=b.replace(a,d.getValueForToken(a,c))});return b};e.prototype.isRelevant=function(a){var c=this.getTokenMap(a);return this.options.filter?this.options.filterLimit&&this.options.filterLimit==this.html.length?!1:this.options.filter(a,c):!0};e.prototype.getTokenMap=function(a){return jQuery.extend({url:a.link,
author:a.author,date:a.publishedDate,title:a.title,body:a.content,shortBody:a.contentSnippet,bodyPlain:a.content.replace(/<script.*<\/script>/gi,"").replace(/<\/?[^>]+>/gi,""),shortBodyPlain:a.contentSnippet.replace(/<\/?[^>]+>/gi,""),index:jQuery.inArray(a,this.entries),totalEntries:this.entries.length,teaserImage:function(a){try{return a.content.match(/(<img.*?>)/gi)[0]}catch(b){return""}}(a),teaserImageUrl:function(a){try{return a.content.match(/(<img.*?>)/gi)[0].match(/src="(.*?)"/)[1]}catch(b){return""}}(a)},
this.options.tokens)};e.prototype.getValueForToken=function(a,c){var b=this.getTokenMap(c),d=a.replace(/[\{\}]/g,""),d=b[d];if("undefined"!=typeof d)return"function"==typeof d?d(c,b):d;throw Error("Unknown token: "+a);};f.fn.rss=function(a,c,b){(new e(this,a,c,b)).render()}})(jQuery);
